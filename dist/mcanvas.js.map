{"version":3,"file":"mcanvas.js","sources":["../lib/utils.js","../lib/mcanvas.js","../lib/mcrop.js","../lib/index.js"],"sourcesContent":["export default {\n    extend(obj1, obj2) {\n        let type = this.isType(obj2)\n        if(type === 'object'){\n            this.forin(obj2, (k, v) => {\n                let vType = this.isType(v)\n                if (vType !== 'object' && vType !== 'array') {\n                    obj1[k] = v\n                } else {\n                    if (this.isType(obj1[k]) !== vType || obj1[k] === null) {\n                        obj1[k] = vType === 'object' ? {} : []\n                    }\n                    this.extend(obj1[k], v)\n                }\n            })\n        }else if(type === 'array'){\n            for (let i = 0; i < obj2.length; i++) {\n                obj1[i] = obj2[i]\n            }\n        }else{\n            obj1 = obj2\n        }\n        return obj1\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image()\n        if(image.indexOf('http') === 0){\n            img.crossOrigin = '*'\n        }\n        img.onload = () => {\n            loaded(img)\n            setTimeout(() => img = null, 1000)\n        }\n        img.onerror = () => {\n            error('img load error')\n        }\n        img.src = image\n    },\n    isObject(tar){\n        return this.isObjFunc(tar, 'Object')\n    },\n    isBoolean(tar){\n        return this.isObjFunc(tar, 'Boolean')\n    },\n    isArr(tar){\n        return this.isObjFunc(tar, 'Array')\n    },\n    getImage(image, cbk, error){\n        if(typeof image === 'string'){\n            this.loadImage(image, img => {\n                cbk(img)\n            }, error)\n        }else if(typeof image === 'object'){\n            cbk(image)\n        }else{\n            console.log('add image error')\n            return\n        }\n    },\n    forin(obj, cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k, obj[k])\n            }\n        }\n    },\n    isIos8(){\n        let UA = window.navigator.userAgent.toLowerCase()\n        let IOS = /(iPhone|iPad|iPod|iOS)/gi.test(UA)\n        let IPAD = /(iPad)/gi.test(UA)\n        if(IOS){\n            return IPAD ? UA.match(/cpu os (\\d*)/)[1] < 9 : UA.match(/iphone os (\\d*)/)[1] < 9\n        }else{\n            return false\n        }\n    },\n    deepCopy(obj){\n        return JSON.parse(JSON.stringify(obj))\n    },\n    isObjFunc(tar, name) {\n        return Object.prototype.toString.call(tar) === '[object ' + name + ']'\n    },\n    isType(tar){\n        return Object.prototype.toString.call(tar).split(' ')[1].replace(']', '').toLowerCase()\n    },\n    getSize(img){\n        let iw, ih\n        if(img.tagName === 'IMG'){\n            iw = img.naturalWidth\n            ih = img.naturalHeight\n        }else if(img.tagName === 'CANVAS'){\n            iw = img.width\n            ih = img.height\n        }else{\n            iw = img.offsetWidth\n            ih = img.offsetHeight\n        }\n        return { iw, ih }\n    },\n}\n","import _ from './utils'\n\nexport default function MCanvas(options = {}){\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))return new MCanvas(options)\n\n    // 配置canvas初始大小；\n    // width：画布宽度，Number,选填，默认为 500;\n    // height: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = _.extend({\n        width: 500,\n        height: 500,\n        backgroundColor : '',\n    }, options)\n\n    // 全局画布；\n    this.canvas = null\n    this.ctx = null\n    // 绘制函数队列；\n    this.queue = []\n    // 回调函数池；\n    this.fn = {\n        // 最后执行的函数；\n        success(){},\n        // 错误回调；\n        error(){},\n    }\n    this.data = {\n        // 文字id；\n        textId: 0,\n        // 文字绘制数据；\n        text : {},\n        // 背景图数据;\n        bgConfig : null,\n    }\n\n    // 初始化创建画布；\n    this._init()\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas')\n    this.canvas.width = this.ops.width\n    this.canvas.height = this.ops.height\n    this.ctx = this.canvas.getContext('2d')\n    this.ctx.save()\n\n    this.ops.backgroundColor && this.setBgColor(this.ops.backgroundColor)\n}\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(image, bg = {\n    type : 'origin',\n}){\n    if(!image && !this.data.bgConfig){\n        console.error('mcanvas error : the init background must has a image.')\n        return\n    }\n\n    // 缓存bg options， 用于重置；\n    if(!image){\n        bg = this.data.bgConfig\n    }else{\n        bg.image = image\n        this.data.bgConfig = bg\n    }\n\n    this.queue.push(() => {\n        if(bg.color)this.setBgColor(bg.color)\n        _.getImage(bg.image, img =>{\n            this._background(img, bg)\n        }, this.fn.error)\n    })\n    return this\n}\n\n// 设置画布颜色;\nMCanvas.prototype.setBgColor = function(color){\n    this.ctx.fillStyle = color\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n}\n\nMCanvas.prototype._getBgAlign = function(left, iw, cw, cropScale){\n    let rv\n    if(typeof left === 'string'){\n        if(left === '50%' || left === 'center'){\n            rv = Math.abs((iw - cw / cropScale) / 2)\n        }else if(left === '100%'){\n            rv = Math.abs(iw - cw / cropScale)\n        }else if(left === '0%'){\n            rv = 0\n        }\n    }else if(typeof left === 'number'){\n        rv = left\n    }else{\n        rv = 0\n    }\n    return rv\n}\nMCanvas.prototype._background = function(img, bg){\n    let { iw, ih } = _.getSize(img)\n    // 图片与canvas的长宽比；\n    let iRatio = iw / ih\n    let cRatio = this.canvas.width / this.canvas.height\n    // 背景绘制参数；\n    let sx, sy, swidth, sheight, dx, dy, dwidth, dheight\n    let cropScale\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            if(iRatio > cRatio){\n                swidth = ih * cRatio\n                sheight = ih\n                cropScale = this.canvas.height / ih\n            }else{\n                swidth = iw\n                sheight = swidth / cRatio\n                cropScale = this.canvas.width / iw\n            }\n\n            sx = this._getBgAlign(bg.left, iw, this.canvas.width, cropScale)\n            sy = this._getBgAlign(bg.top, ih, this.canvas.height, cropScale)\n\n            dy = dx = 0\n            dheight = this.canvas.height\n            dwidth = this.canvas.width\n            break\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0\n            swidth = iw\n            sheight = ih\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width\n                dheight = dwidth / iRatio\n                dx = bg.left || 0\n                dy = (bg.top || bg.top === 0) ? bg.top : (this.canvas.height - dheight) / 2\n            }else{\n                dheight = this.canvas.height\n                dwidth = dheight * iRatio\n                dy = bg.top || 0\n                dx = (bg.left || bg.left === 0) ? bg.left : (this.canvas.width - dwidth) / 2\n            }\n            break\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = iw\n            this.canvas.height = ih\n            sx = sy = 0\n            swidth = iw\n            sheight = ih\n            dx = dy = 0\n            dwidth = this.canvas.width\n            dheight = this.canvas.height\n            break\n        default:\n            console.error('mcanvas error:background type error!')\n            return\n    }\n    this.ctx.drawImage(img, sx, sy, swidth, sheight, dx, dy, dwidth, dheight)\n    this._next()\n}\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制矩形层；\nMCanvas.prototype.rect = function(ops){\n    this.queue.push(() => {\n        let { fillColor = '#fff', strokeColor = fillColor, strokeWidth = 0 } = ops\n        let cw = this.canvas.width, ch = this.canvas.height\n        let width = this._get(cw, 0, ops.width || 0, 'pos') - 2 * strokeWidth,\n            height = this._get(ch, 0, ops.height || 0, 'pos') - 2 * strokeWidth\n        let x = this._get(cw, width, ops.x || 0, 'pos') + strokeWidth / 2,\n            y = this._get(ch, height, ops.y || 0, 'pos') + strokeWidth / 2\n        this.ctx.lineWidth = strokeWidth\n        this.ctx.fillStyle = fillColor\n        this.ctx.strokeStyle = strokeColor\n\n        this.ctx.beginPath()\n        this.ctx.strokeRect(x, y, width, height)\n        this.ctx.fillRect(x, y, width, height)\n        this.ctx.closePath()\n\n        this._resetCtx()._next()\n    })\n    return this\n}\n\n// 绘制圆形层；\nMCanvas.prototype.circle = function(ops){\n    this.queue.push(() => {\n        let { fillColor = '#fff', strokeColor = fillColor, strokeWidth = 0 } = ops\n        let cw = this.canvas.width, ch = this.canvas.height\n        let r = this._get(cw, 0, ops.r || 0, 'pos') - 2 * strokeWidth\n        let x = this._get(cw, 2 * r, ops.x || 0, 'pos') + strokeWidth / 2 + r,\n            y = this._get(ch, 2 * r, ops.y || 0, 'pos') + strokeWidth / 2 + r\n\n        this.ctx.beginPath()\n        this.ctx.arc(x, y, r, 0, Math.PI * 2, false)\n        this.ctx.fillStyle = fillColor\n        this.ctx.fill()\n        this.ctx.strokeStyle = strokeColor\n        this.ctx.lineWidth = strokeWidth\n        this.ctx.stroke()\n        this.ctx.closePath()\n\n        this._resetCtx()._next()\n    })\n    return this\n}\n\n// 重置ctx属性;\nMCanvas.prototype._resetCtx = function(){\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0)\n    this.ctx.restore()\n    return this\n}\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '', ops){\n    if(!image){\n        console.error('mcanvas error : there is not image of watermark.')\n        return\n    }\n    // 参数默认值；\n    let { width = '40%', pos = 'rightbottom', margin = 20 } = ops\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    }\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`\n            position.y = `top:${margin}`\n            break\n        case 'leftBottom':\n            position.x = `left:${margin}`\n            position.y = `bottom:${margin}`\n            break\n        case 'rightTop':\n            position.x = `right:${margin}`\n            position.y = `top:${margin}`\n            break\n        case 'rightBottom':\n            position.x = `right:${margin}`\n            position.y = `bottom:${margin}`\n            break\n        default:\n    }\n    this.add(image, {\n        width,\n        pos:position,\n    })\n    return this\n}\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '', options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    }\n\n    if(!_.isArr(image))image = [{image, options}]\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img, this._handleOps(_.extend(def, v.options), img))\n            }, this.fn.error)\n        })\n    })\n\n    return this\n}\n\nMCanvas.prototype._add = function(img, ops){\n    if(ops.width === 0)console.warn(`mcanvas warn: the width of mc-element is zero`)\n    let { iw, ih } = _.getSize(img)\n    // let ratio = iw / ih;\n    // 画布canvas参数；\n    let cdx, cdy, cdw, cdh\n    // 素材canvas参数；\n    let { x: lsx, y: lsy, width: lsw, height: lsh } = ops.crop\n\n    let cratio = lsw / lsh\n    let ldx, ldy, ldw, ldh\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas')\n    let lctx = lcvs.getContext('2d')\n    // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n    // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n    // _ratio 为 较大边 / 较小边 的比例；\n    let _ratio = iw > ih ? iw / ih : ih / iw\n    let lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4\n    let spaceX, spaceY\n\n    lcvs.width =  Math.round(lsw * lctxScale)\n    lcvs.height = Math.round(lsh * lctxScale)\n\n    // 限制canvas的大小，ios8以下为 2096, 其余平台均限制为 4096;\n    let shrink\n    if(_.isIos8() && (lcvs.width > 2096 || lcvs.height > 2096)){\n        if(cratio > 1){\n            shrink = 2096 / lcvs.width\n        }else{\n            shrink = 2096 / lcvs.height\n        }\n    }else if(lcvs.width > 4096 || lcvs.height > 4096){\n        if(cratio > 1){\n            shrink = 4096 / lcvs.width\n        }else{\n            shrink = 4096 / lcvs.height\n        }\n    }\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = - Math.round(lsw / 2)\n    ldy = - Math.round(lsh / 2)\n    ldw = lsw\n    ldh = Math.round(lsw / cratio)\n\n    // 获取素材最终的宽高;\n    if(shrink){\n        [lcvs.width, lcvs.height, ldx, ldy, ldw, ldh] = [lcvs.width, lcvs.height, ldx, ldy, ldw, ldh].map(v => Math.round(v * shrink))\n    }\n\n    lctx.translate(lcvs.width / 2, lcvs.height / 2)\n    lctx.rotate(ops.pos.rotate)\n    \n    lctx.drawImage(img, lsx, lsy, lsw, lsh, ldx, ldy, ldw, ldh)\n\n    cdw = Math.round(ops.width * lctxScale)\n    cdh = Math.round(cdw / cratio)\n\n    spaceX = (lctxScale - 1) * ops.width / 2\n    spaceY = spaceX / cratio\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = Math.round(ops.pos.x + cdw * ( 1 - ops.pos.scale ) / 2 - spaceX)\n    cdy = Math.round(ops.pos.y + cdh * ( 1 - ops.pos.scale ) / 2 - spaceY)\n\n    cdw *= ops.pos.scale\n    cdh *= ops.pos.scale\n\n    this.ctx.drawImage(lcvs, cdx, cdy, cdw, cdh)\n\n    lcvs = lctx = null\n    this._next()\n}\n\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops, img){\n    let cw = this.canvas.width,\n        ch = this.canvas.height\n    let { iw, ih } = _.getSize(img)\n\n    // 图片宽高比；\n    let ratio = iw / ih\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw, iw, ops.width, 'pos')\n\n    // 裁剪的最大宽高；\n    let maxLsw, maxLsh\n\n    // 裁剪参数；\n    let { x:cropx, y:cropy, width:cropw, height:croph } = ops.crop\n    let crop = {}\n    crop.width = this._get(cw, iw, cropw, 'crop')\n    crop.height = this._get(ch, ih, croph, 'crop')\n    crop.x = this._get(iw, crop.width, cropx, 'crop')\n    crop.y = this._get(ih, crop.height, cropy, 'crop')\n\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw\n    if(crop.y > ih)crop.y = ih\n    maxLsw = iw - crop.x\n    maxLsh = ih - crop.y\n    if(crop.width > maxLsw)crop.width = maxLsw\n    if(crop.height > maxLsh)crop.height = maxLsh\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos\n    let pos = {\n        x:this._get(cw, width, px, 'pos'),\n        y:this._get(ch, width / ratio, py, 'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    }\n    return {width, crop, pos}\n}\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`\n    // 默认的字体大小;\n    let size = this.canvas.width / 20\n\n    this.queue.push(()=>{\n        let defaultStyle = {\n            color:'#000',\n            type : 'fill',   // strokeText or fillText,\n            lineWidth : 1,\n            shadow:{\n                color: null,\n                blur: 0,\n                offsetX: 0,\n                offsetY: 0,\n            },\n        }\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                lineHeight:size * 0.9,\n                ..._.deepCopy(defaultStyle),\n            },\n            normalStyle:{\n                font : `${size}px ${fontFamily}`,\n                lineHeight:size * 1.1,\n                type : 'fill',   // strokeText or fillText,\n                ..._.deepCopy(defaultStyle),\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                lineHeight:size * 1.4,\n                ..._.deepCopy(defaultStyle),\n            },\n            pos:{\n                x:0,\n                y:0,\n                rotate: 0,\n            },\n        }\n\n        option = _.extend(option, ops)\n\n        // 解析字符串模板后，调用字体绘制函数；\n        let parseContext = this._parse(context)\n        let max = 0, maxFont\n        parseContext.map(v => {\n            if (v.size > max) {\n                max = v.size\n                maxFont = v.type\n            }\n        })\n        // 当设置的宽度小于字体宽度时，强行将设置宽度设为与字体一致；\n        let maxFontSize = parseInt(option[`${maxFont}Style`].font)\n        if (maxFontSize && option.width < maxFontSize) option.width = maxFontSize\n\n        this._text(parseContext, option)\n        this._resetCtx()._next()\n    })\n    return this\n}\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/)\n    let result = []\n    for(let i = 0;i < arr.length;i++){\n        let value = arr[i]\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large'\n            let tmp = arr[i].split(splitTag)\n            result.push({\n                type,\n                text:tmp[0],\n                // 用于字体的大小比较；\n                size: type === 'small' ? 0 : 2,\n            })\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n                size: 1,\n            })\n            continue\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n            size: 1,\n        })\n    }\n    return result\n}\n\nMCanvas.prototype._text = function(textArr, option){\n\n    this.data.textId++\n    this.data.text[this.data.textId] = {}\n\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width, 0, option.width, 'pos')\n\n    let style, line = 1, length = 0,\n        lineHeight = getLineHeight(textArr, option),\n        x = this._get(this.canvas.width, option.width, 0, 'pos'),\n        y = (this._get(this.canvas.height, 0, 0, 'pos')) + lineHeight\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.data.text[this.data.textId][line] = {\n        data:[],\n        lineWidth:0,\n    }\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`]\n        this.ctx.font = style.font\n        let width = this.ctx.measureText(v.text).width\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g, '|')\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i = 0, fontLength = context.length; i < fontLength; i++) {\n                let font = context[i]\n                width = this.ctx.measureText(font).width\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font === '|'){\n                    length = 0\n                    x = this._get(this.canvas.width, option.width, 0, 'pos')\n                    y += lineHeight\n                    line += 1\n                    this.data.text[this.data.textId][line] = {\n                        data:[],\n                        lineWidth:0,\n                    }\n                    if(font === '|')continue\n                }\n                this.data.text[this.data.textId][line]['data'].push({\n                    context:font, x, y, style, width,\n                })\n                length += width\n                x += width\n                this.data.text[this.data.textId][line]['lineWidth'] = length\n            }\n        }else{\n            this.data.text[this.data.textId][line]['data'].push({\n                context, x, y, style, width,\n            })\n            length += width\n            x += width\n            this.data.text[this.data.textId][line]['lineWidth'] = length\n        }\n    })\n\n    // 创建文字画布；\n    const tcvs = document.createElement('canvas')\n    const tctx = tcvs.getContext('2d')\n    const tdx = this._get(this.canvas.width, option.width, option.pos.x, 'pos'), \n          tdy = this._get(this.canvas.height, 0, option.pos.y, 'pos')\n    let tdw, tdh\n    tdw = tcvs.width = option.width\n    tdh = tcvs.height = this._getTextRectHeight(line)\n        \n    // 通过字体数据进行文字的绘制；\n    _.forin(this.data.text[this.data.textId], (k, v)=>{\n        // \b增加 align 的功能；\n        let add = 0\n        if(v.lineWidth < option.width){\n            if(option.align === 'center'){\n                add = (option.width - v.lineWidth) / 2\n            }else if (option.align === 'right') {\n                add = option.width - v.lineWidth\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add\n            this._fillText(tctx, text)\n        })\n    })\n\n    // tcvs.style.width = '300px';\n    // document.querySelector('body').appendChild(tcvs);\n    \n    // 绘制文字画布；\n    const originX = tdx + tdw / 2,\n          originY = tdy + tdh / 2\n    this.ctx.translate(originX, originY)\n    this.ctx.rotate(parseFloat(option.pos.rotate) * Math.PI / 180)\n    this.ctx.drawImage(tcvs, -tdw / 2, -tdh / 2, tdw, tdh)\n\n    // 获取行高；\n    function getLineHeight(textArr, option) {\n        let lh = 0, vlh\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineHeight\n            if(vlh > lh)lh = vlh\n        })\n        return lh\n    }\n}\n\nMCanvas.prototype._fillText = function(ctx, text){\n    let {context, x, y, style} = text\n    let {align, lineWidth, shadow} = style\n    let {color, blur, offsetX, offsetY} = shadow\n    ctx.font = style.font\n    ctx.textAlign = align\n    ctx.textBaseline = 'alphabetic'\n    ctx.lineWidth = lineWidth\n    ctx.shadowColor = color\n    ctx.shadowBlur = blur\n    ctx.shadowOffsetX = offsetX\n    ctx.shadowOffsetY = offsetY\n\n    if(style.gradient){\n        let { type, colorStop } = style.gradient\n        let x1, y1, x2, y2\n        if(type === 1){\n            x1 = x; y1 = y\n            x2 = x + text.width; y2 = y \n        }else{\n            x1 = x; y1 = y - style.lineHeight\n            x2 = x; y2 = y\n        }\n        let grad  = ctx.createLinearGradient(x1, y1, x2, y2)\n        let colorNum = colorStop.length || 0\n        _.forin(colorStop, (i, v)=>{\n            grad.addColorStop(1 / colorNum * (+i + 1), v)\n        })\n        ctx[`${style.type}Style`] = grad\n    }else{\n        ctx[`${style.type}Style`] = style.color\n    }\n\n    ctx[`${style.type}Text`](context, x, y)\n    this._resetCtx()\n}\n\nMCanvas.prototype._getTextRectHeight = function (lastLine) {\n    const lastLineData = this.data.text[this.data.textId][lastLine].data[0]\n    return lastLineData.y + lastLineData.style.lineHeight\n}\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par, child, str, type){\n    let result = str\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type === 'pos'){\n            let arr = str.split(':')\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px', ''))\n                    break\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px', ''))) - child\n                    break\n                default:\n            }\n        } else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            if(type === 'crop'){\n                result = child * (+str.replace('%', '')) / 100\n            }else{\n                result = par * (+str.replace('%', '')) / 100\n            }\n        } else if (str === 'center'){\n            result = (par - child) / 2\n        } else if (str === 'origin') {\n            result = child\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\n// 绘制函数；\nMCanvas.prototype.draw = function(ops){\n    let _ops = {\n        type:'jpg',\n        quality:.9,\n        success(){},\n        error(){},\n    }, b64\n    if(typeof ops === 'function'){\n        _ops.success = ops\n    }else{\n        _ops = _.extend(_ops, ops)\n        if(_ops.type === 'jpg')_ops.type = 'jpeg'\n    }\n    this.fn.error = _ops.error\n    this.fn.success = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL(`image/${_ops.type}`, _ops.quality)\n            _ops.success(b64)\n        }, 0)\n    }\n    this._next()\n    return this\n}\n\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()()\n    }else{\n        this.fn.success()\n    }\n}\n\nMCanvas.prototype.clear = function(){\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    return this\n}","import _ from './utils'\n\nconst getPos = (imgW, cropW, str) => {\n    if (!str && str !== 0) return str\n    let result = str\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1){\n            let arr = str.split(':')\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px', ''))\n                    break\n                case 'right':\n                case 'bottom':\n                    result = imgW - (+(arr[1].replace('px', '')))\n                    break\n                default:\n            }\n        } else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            result = imgW * (+str.replace('%', '')) / 100\n        } else if (str === 'center'){\n            result = (imgW - cropW) / 2\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\nconst getLength = (imgW, str) => {\n    if (!str && str !== 0) return str\n    let result = str\n    if(typeof str === 'string'){\n        if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            result = imgW * (+str.replace('%', '')) / 100\n        } else if (str === 'center'){\n            result = imgW / 2\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\n// interface ops {\n//     type: 'rect' | 'circle' | 'triangle'\n//  左上角坐标\n//     x: number | string \n//     y: number | string\n//  type = 'rect' 时有效\n//     width?: number | string\n//     height?: number | string\n//  type = 'circle' 时有效   \n//     r?: number | string\n//     exportConfig?: {\n//         type: 'jpg' | 'png' | 'jpeg'\n//         quality: number (0 - 1)\n//     }\n// }\n\nexport default function MCrop(image, ops = {}){\n    if (!image) {\n        console.error('mcrop error : there is not a image.')\n        return\n    }\n    const { success = () => {}, error = () => {} } = ops\n    _.getImage(image, img => {\n        const { iw, ih } = _.getSize(img)\n        const minL = Math.min(iw, ih)\n        const { type = 'rect' } = ops\n        const cvs = document.createElement('canvas')\n        const ctx = cvs.getContext('2d')\n        if (type === 'rect') {\n            let width = getLength(iw, ops.width) || iw\n            let height = getLength(ih, ops.height) || ih\n            if (width > iw) width = iw\n            if (height > ih) height = ih\n            const x = getPos(iw, width, ops.x)\n            const y = getPos(ih, height, ops.y)\n            // 扣除超出部分，避免截图出现空白\n            if (x + width > iw) width =  iw - x\n            if (y + height > ih) height =  ih - y\n            cvs.width = width\n            cvs.height = height             \n            ctx.drawImage(img, -x, -y, iw, ih)\n        } else if (type === 'circle') {\n            let r = getLength(minL, ops.r) || (minL / 2)\n            if (r * 2 > minL) r = minL / 2\n            const x = getPos(iw, r * 2, ops.x)\n            const y = getPos(ih, r * 2, ops.y)\n            cvs.width = r * 2\n            cvs.height = r * 2\n            ctx.beginPath()\n            ctx.arc(r, r, r, 0, Math.PI * 2, false)\n            ctx.fillStyle = '#fff'\n            ctx.fill()\n            ctx.globalCompositeOperation = 'source-in'\n            ctx.drawImage(img, -x, -y, iw, ih)\n        }\n        setTimeout(()=>{\n            const exportConfig = _.extend({\n                type:'jpg',\n                quality:.9,\n            }, ops.exportConfig || {}) \n            const b64 = cvs.toDataURL(`image/${exportConfig.type}`, exportConfig.quality)\n            success(b64)\n        }, 0)\n    }, err => {\n        console.error('mcrop error : load image error.', err)\n        error(err)\n    })\n}","import MCanvas from './mcanvas'\nimport _mcrop from './mcrop'\n\nexport default MCanvas\nexport const MCrop = _mcrop\n\nif(!window.MCanvas) window.MCanvas = MCanvas\nif(!window.MCrop) window.MCrop = MCrop"],"names":["extend","obj1","obj2","type","isType","forin","k","v","vType","i","length","loadImage","image","loaded","error","img","Image","indexOf","crossOrigin","onload","setTimeout","onerror","src","isObject","tar","isObjFunc","isBoolean","isArr","getImage","cbk","console","log","obj","hasOwnProperty","isIos8","UA","window","navigator","userAgent","toLowerCase","IOS","test","IPAD","match","deepCopy","JSON","parse","stringify","name","Object","prototype","toString","call","split","replace","getSize","iw","ih","tagName","naturalWidth","naturalHeight","width","height","offsetWidth","offsetHeight","MCanvas","options","ops","_","backgroundColor","canvas","ctx","queue","fn","success","data","textId","text","bgConfig","_init","document","createElement","getContext","save","setBgColor","background","bg","push","color","_background","fillStyle","fillRect","_getBgAlign","left","cw","cropScale","rv","Math","abs","iRatio","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","top","drawImage","_next","rect","fillColor","strokeColor","strokeWidth","ch","_get","x","y","lineWidth","strokeStyle","beginPath","strokeRect","closePath","_resetCtx","circle","r","arc","PI","fill","stroke","setTransform","restore","watermark","pos","margin","position","scale","rotate","add","def","crop","forEach","_add","_handleOps","warn","cdx","cdy","cdw","cdh","lsx","lsy","lsw","lsh","cratio","ldx","ldy","ldw","ldh","lcvs","lctx","_ratio","lctxScale","spaceX","spaceY","round","shrink","map","translate","ratio","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","context","fontFamily","size","defaultStyle","shadow","blur","offsetX","offsetY","option","align","smallStyle","font","lineHeight","normalStyle","largeStyle","parseContext","_parse","max","maxFont","maxFontSize","parseInt","_text","arr","result","value","splitTag","tmp","textArr","style","line","getLineHeight","measureText","fontLength","tcvs","tctx","tdx","tdy","tdw","tdh","_getTextRectHeight","_fillText","originX","originY","lh","vlh","textAlign","textBaseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","gradient","colorStop","x1","y1","x2","y2","grad","createLinearGradient","colorNum","addColorStop","lastLine","lastLineData","par","child","str","draw","_ops","quality","b64","toDataURL","shift","clear","clearRect","getPos","imgW","cropW","getLength","MCrop","minL","min","cvs","globalCompositeOperation","exportConfig","err","_mcrop"],"mappings":"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"}