{"version":3,"file":"mcanvas.js","sources":["../src/utils.js","../src/icon.js","../src/index.js"],"sourcesContent":["export default {\n    extend(obj1, obj2) {\n        let type = this.isType(obj2)\n        if(type == 'object'){\n            this.forin(obj2, (k,v) => {\n                let vType = this.isType(v)\n                if (vType !== 'object' && vType !== 'array') {\n                    obj1[k] = v\n                } else {\n                    if (this.isType(obj1[k]) !== vType || obj1[k] === null) {\n                        obj1[k] = vType == 'object' ? {} : []\n                    }\n                    this.extend(obj1[k], v)\n                }\n            })\n        }else if(type == 'array'){\n            for (let i = 0; i < obj2.length; i++) {\n                obj1[i] = obj2[i]\n            }\n        }else{\n            obj1 = obj2\n        }\n        return obj1\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image()\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*'\n        }\n        img.onload = () => {\n            loaded(img)\n            setTimeout(()=>{\n                img = null\n            },1000)\n        }\n        img.onerror = () => {\n            error('img load error')\n        }\n        img.src = image\n    },\n    isObject(tar){\n        return this.isObjFunc(tar, 'Object')\n    },\n    isBoolean(tar){\n        return this.isObjFunc(tar, 'Boolean')\n    },\n    isArr(tar){\n        return this.isObjFunc(tar, 'Array')\n    },\n    getImage(image, cbk, error){\n        if(typeof image == 'string'){\n                this.loadImage(image, img => {\n                    cbk(img)\n                },error)\n        }else if(typeof image == 'object'){\n            cbk(image)\n        }else{\n            console.log('add image error')\n            return\n        }\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k])\n            }\n        }\n    },\n    isIos8(){\n        let UA = window.navigator.userAgent.toLowerCase()\n        let IOS = /(iPhone|iPad|iPod|iOS)/gi.test(UA)\n        let IPAD = /(iPad)/gi.test(UA)\n        if(IOS){\n            return IPAD ? UA.match(/cpu os (\\d*)/)[1] < 9 : UA.match(/iphone os (\\d*)/)[1] < 9\n        }else{\n            return false\n        }\n    },\n    deepCopy(obj){\n        return JSON.parse(JSON.stringify(obj))\n    },\n    isObjFunc(tar, name) {\n        return Object.prototype.toString.call(tar) === '[object ' + name + ']'\n    },\n    isType(tar){\n        return Object.prototype.toString.call(tar).split(' ')[1].replace(']','').toLowerCase()\n    },\n    getSize(img){\n        let iw, ih\n        if(img.tagName === 'IMG'){\n            iw = img.naturalWidth\n            ih = img.naturalHeight\n        }else if(img.tagName === 'CANVAS'){\n            iw = img.width\n            ih = img.height\n        }else{\n            iw = img.offsetWidth\n            ih = img.offsetHeight\n        }\n        return { iw, ih }\n    },\n}\n","import _ from './utils'\n\nexport default function(options = {}) {\n    const { icon, color } = _.extend({}, options)\n    \n    const cvs = document.createElement('canvas')\n    const ctx = cvs.getContext('2d')\n    _.getImage(icon, (img) => {\n        const { iw, ih } = _.getSize(img)\n        cvs.width = iw\n        cvs.height = ih\n        ctx.save()\n        ctx.drawImage(img, 0, 0)\n\n        ctx.globalCompositeOperation = 'source-in'\n\n        ctx.fillStyle = color\n        ctx.fillRect(0, 0, cvs.width, cvs.height)\n\n        cvs.style.width = '300px'\n        document.querySelector('body').appendChild(cvs)\n    }, (err) => {\n        console.log(err)\n    })\n}","import _ from './utils'\nimport _iconHover from './icon'\n\nexport const iconHover = _iconHover\n\nexport default function MCanvas(options = {}){\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))return new MCanvas(options)\n\n    // 配置canvas初始大小；\n    // width：画布宽度，Number,选填，默认为 500;\n    // height: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = _.extend({\n        width: 500,\n        height: 500,\n        backgroundColor : '',\n    }, options)\n\n    // 全局画布；\n    this.canvas = null\n    this.ctx = null\n    // 绘制函数队列；\n    this.queue = []\n    // 回调函数池；\n    this.fn = {\n        // 最后执行的函数；\n        success(){},\n        // 错误回调；\n        error(){},\n    }\n    this.data = {\n        // 文字id；\n        textId: 0,\n        // 文字绘制数据；\n        text : {},\n        // 背景图数据;\n        bgConfig : null,\n    }\n\n    // 初始化创建画布；\n    this._init()\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas')\n    this.canvas.width = this.ops.width\n    this.canvas.height = this.ops.height\n    this.ctx = this.canvas.getContext('2d')\n    this.ctx.save()\n\n    this.ops.backgroundColor && this.setBgColor(this.ops.backgroundColor)\n}\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(image, bg = {\n    type : 'origin',\n}){\n    if(!image && !this.data.bgConfig){\n        console.error('mcanvas error : the init background must has a image.')\n        return\n    }\n\n    // 缓存bg options， 用于重置；\n    if(!image){\n        bg = this.data.bgConfig\n    }else{\n        bg.image = image\n        this.data.bgConfig = bg\n    }\n\n    this.queue.push(() => {\n        if(bg.color)this.setBgColor(bg.color)\n        _.getImage(bg.image, img =>{\n            this._background(img, bg)\n        },this.fn.error)\n    })\n    return this\n}\n\n// 设置画布颜色;\nMCanvas.prototype.setBgColor = function(color){\n    this.ctx.fillStyle = color\n    this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)\n}\n\nMCanvas.prototype._getBgAlign = function(left,iw,cw,cropScale){\n    let rv\n    if(typeof left == 'string'){\n        if(left == '50%' || left == 'center'){\n            rv = Math.abs((iw - cw / cropScale) / 2)\n        }else if(left == '100%'){\n            rv = Math.abs(iw - cw / cropScale)\n        }else if(left == '0%'){\n            rv = 0\n        }\n    }else if(typeof left == 'number'){\n        rv = left\n    }else{\n        rv = 0\n    }\n    return rv\n}\nMCanvas.prototype._background = function(img, bg){\n    let { iw, ih } = this._getSize(img)\n    // 图片与canvas的长宽比；\n    let iRatio = iw / ih\n    let cRatio = this.canvas.width / this.canvas.height\n    // 背景绘制参数；\n    let sx,sy,swidth,sheight,dx,dy,dwidth,dheight\n    let cropScale\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            if(iRatio > cRatio){\n                swidth = ih * cRatio\n                sheight = ih\n                cropScale = this.canvas.height / ih\n            }else{\n                swidth = iw\n                sheight = swidth / cRatio\n                cropScale = this.canvas.width / iw\n            }\n\n            sx = this._getBgAlign(bg.left,iw, this.canvas.width,cropScale)\n            sy = this._getBgAlign(bg.top,ih,this.canvas.height,cropScale)\n\n            dy = dx = 0\n            dheight = this.canvas.height\n            dwidth = this.canvas.width\n            break\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0\n            swidth = iw\n            sheight = ih\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width\n                dheight = dwidth / iRatio\n                dx = bg.left || 0\n                dy = (bg.top || bg.top == 0) ? bg.top : (this.canvas.height - dheight)/2\n            }else{\n                dheight = this.canvas.height\n                dwidth = dheight * iRatio\n                dy = bg.top || 0\n                dx = (bg.left || bg.left == 0) ? bg.left : (this.canvas.width - dwidth)/2\n            }\n            break\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = iw\n            this.canvas.height = ih\n            sx = sy = 0\n            swidth = iw\n            sheight = ih\n            dx = dy = 0\n            dwidth = this.canvas.width\n            dheight = this.canvas.height\n            break\n        default:\n            console.error('mcanvas error:background type error!')\n            return\n    }\n    this.ctx.drawImage(img,sx,sy,swidth,sheight,dx,dy,dwidth,dheight)\n    this._next()\n}\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制矩形层；\nMCanvas.prototype.rect = function(ops){\n    this.queue.push(() => {\n        let { fillColor = '#fff', strokeColor = fillColor, strokeWidth = 0} = ops\n        let cw = this.canvas.width , ch = this.canvas.height\n        let width = this._get(cw, 0, ops.width || 0, 'pos') - 2 * strokeWidth,\n            height = this._get(ch, 0, ops.height || 0, 'pos') - 2 * strokeWidth\n        let x = this._get(cw, width, ops.x || 0 ,'pos') + strokeWidth / 2,\n            y = this._get(ch, height, ops.y || 0 ,'pos') + strokeWidth / 2\n        this.ctx.lineWidth = strokeWidth\n        this.ctx.fillStyle = fillColor\n        this.ctx.strokeStyle = strokeColor\n\n        this.ctx.beginPath()\n        this.ctx.strokeRect(x, y, width, height)\n        this.ctx.fillRect(x, y, width, height)\n        this.ctx.closePath()\n\n        this._resetCtx()._next()\n    })\n    return this\n}\n\n// 绘制圆形层；\nMCanvas.prototype.circle = function(ops){\n    this.queue.push(() => {\n        let { fillColor = '#fff', strokeColor = fillColor, strokeWidth = 0 } = ops\n        let cw = this.canvas.width , ch = this.canvas.height\n        let r = this._get(cw, 0, ops.r || 0, 'pos') - 2 * strokeWidth\n        let x = this._get(cw, 2 * r, ops.x || 0 ,'pos') + strokeWidth / 2 + r,\n            y = this._get(ch, 2 * r, ops.y || 0 ,'pos') + strokeWidth / 2 + r\n\n        this.ctx.beginPath()\n        this.ctx.arc(x,y,r,0,Math.PI*2,false)\n        this.ctx.fillStyle = fillColor\n        this.ctx.fill()\n        this.ctx.strokeStyle = strokeColor\n        this.ctx.lineWidth = strokeWidth\n        this.ctx.stroke()\n        this.ctx.closePath()\n\n        this._resetCtx()._next()\n    })\n    return this\n}\n\n// 重置ctx属性;\nMCanvas.prototype._resetCtx = function(){\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0)\n    this.ctx.restore()\n    return this\n}\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '', ops){\n    if(!image){\n        console.error('mcanvas error : there is not image of watermark.')\n        return\n    }\n    // 参数默认值；\n    let { width = '40%' , pos = 'rightbottom' , margin = 20 } = ops\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    }\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`\n            position.y = `top:${margin}`\n            break\n        case 'leftBottom':\n            position.x = `left:${margin}`\n            position.y = `bottom:${margin}`\n            break\n        case 'rightTop':\n            position.x = `right:${margin}`\n            position.y = `top:${margin}`\n            break\n        case 'rightBottom':\n            position.x = `right:${margin}`\n            position.y = `bottom:${margin}`\n            break\n        default:\n    }\n    this.add(image,{\n        width,\n        pos:position,\n    })\n    return this\n}\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '',options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    }\n\n    if(!_.isArr(image))image = [{image,options}]\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img,this._handleOps(_.extend(def,v.options),img))\n            },this.fn.error)\n        })\n    })\n\n    return this\n}\n\nMCanvas.prototype._add = function(img,ops){\n    if(ops.width == 0)console.warn(`mcanvas warn: the width of mc-element is zero`)\n    let { iw, ih } = this._getSize(img)\n    // let ratio = iw / ih;\n    // 画布canvas参数；\n    let cdx,cdy,cdw,cdh\n    // 素材canvas参数；\n    let { x:lsx, y:lsy, width:lsw, height:lsh } = ops.crop\n\n    let cratio = lsw / lsh\n    let ldx,ldy,ldw,ldh\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas')\n    let lctx = lcvs.getContext('2d')\n    // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n    // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n    // _ratio 为 较大边 / 较小边 的比例；\n    let _ratio = iw > ih ? iw / ih : ih / iw\n    let lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4\n    let spaceX,spaceY\n\n    lcvs.width =  lsw * lctxScale\n    lcvs.height = lsh * lctxScale\n\n    // 限制canvas的大小，ios8以下为 2096, 其余平台均限制为 4096;\n    let shrink\n    if(_.isIos8() && (lcvs.width > 2096 || lcvs.height > 2096)){\n        if(cratio > 1){\n            shrink = 2096 / lcvs.width\n        }else{\n            shrink = 2096 / lcvs.height\n        }\n    }else if(lcvs.width > 4096 || lcvs.height > 4096){\n        if(cratio > 1){\n            shrink = 4096 / lcvs.width\n        }else{\n            shrink = 4096 / lcvs.height\n        }\n    }\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = - Math.round(lsw / 2)\n    ldy = - Math.round(lsh / 2)\n    ldw = lsw\n    ldh = Math.round(lsw / cratio)\n\n    // 获取素材最终的宽高;\n    if(shrink){\n        [lcvs.width,lcvs.height,ldx,ldy,ldw,ldh] = [lcvs.width,lcvs.height,ldx,ldy,ldw,ldh].map(v => Math.round(v*shrink))\n    }\n\n    lctx.translate(lcvs.width/2,lcvs.height/2)\n    lctx.rotate(ops.pos.rotate)\n    \n    lctx.drawImage(img,lsx,lsy,lsw,lsh,ldx,ldy,ldw,ldh)\n\n    // lcvs.style.width = '300px';\n    // document.querySelector('body').appendChild(lcvs);\n\n    cdw = ops.width * lctxScale\n    cdh = cdw / cratio\n\n    spaceX = (lctxScale - 1) * ops.width / 2\n    spaceY = spaceX / cratio\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = ops.pos.x + cdw * ( 1 - ops.pos.scale )/2 - spaceX\n    cdy = ops.pos.y + cdh * ( 1 - ops.pos.scale )/2 - spaceY\n\n    cdw *= ops.pos.scale\n    cdh *= ops.pos.scale\n\n    this.ctx.drawImage(lcvs,cdx,cdy,cdw,cdh)\n\n    lcvs = lctx = null\n    this._next()\n}\n\n// 获取宽高，兼容img，canvas\nMCanvas.prototype._getSize = function(img){\n    let iw, ih\n    if(img.tagName === 'IMG'){\n        iw = img.naturalWidth\n        ih = img.naturalHeight\n    }else if(img.tagName === 'CANVAS'){\n        iw = img.width\n        ih = img.height\n    }else{\n        iw = img.offsetWidth\n        ih = img.offsetHeight\n    }\n    return { iw, ih }\n}\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops,img){\n    let cw = this.canvas.width,\n        ch = this.canvas.height\n    let { iw, ih } = this._getSize(img)\n\n    // 图片宽高比；\n    let ratio = iw / ih\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw,iw,ops.width,'pos')\n\n    // 裁剪的最大宽高；\n    let maxLsw,maxLsh\n\n    // 裁剪参数；\n    let { x:cropx,y:cropy,width:cropw,height:croph } = ops.crop\n    let crop = {}\n    crop.width = this._get(cw,iw,cropw,'crop')\n    crop.height = this._get(ch,ih,croph,'crop')\n    crop.x = this._get(iw,crop.width,cropx,'crop')\n    crop.y = this._get(ih,crop.height,cropy,'crop')\n\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw\n    if(crop.y > ih)crop.y = ih\n    maxLsw = iw - crop.x\n    maxLsh = ih - crop.y\n    if(crop.width > maxLsw)crop.width = maxLsw\n    if(crop.height > maxLsh)crop.height = maxLsh\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos\n    let pos = {\n        x:this._get(cw,width,px,'pos'),\n        y:this._get(ch,width/ratio,py,'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    }\n    return {width,crop,pos}\n}\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`\n    // 默认的字体大小;\n    let size = this.canvas.width / 20\n\n    this.queue.push(()=>{\n        let defaultStyle = {\n            color:'#000',\n            type : 'fill',   // strokeText or fillText,\n            lineWidth : 1,\n            shadow:{\n                color: null,\n                blur: 0,\n                offsetX: 0,\n                offsetY: 0,\n            },\n        }\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                lineHeight:size * 0.9,\n                ..._.deepCopy(defaultStyle),\n            },\n            normalStyle:{\n                font : `${size}px ${fontFamily}`,\n                lineHeight:size*1.1,\n                type : 'fill',   // strokeText or fillText,\n                ..._.deepCopy(defaultStyle),\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                lineHeight:size * 1.4,\n                ..._.deepCopy(defaultStyle),\n            },\n            pos:{\n                x:0,\n                y:0,\n                rotate: 0,\n            },\n        }\n\n        option = _.extend(option,ops)\n\n        // 解析字符串模板后，调用字体绘制函数；\n        let parseContext = this._parse(context)\n        let max = 0, maxFont\n        parseContext.map(v => {\n            if (v.size > max) {\n                max = v.size\n                maxFont = v.type\n            }\n        })\n        // 当设置的宽度小于字体宽度时，强行将设置宽度设为与字体一致；\n        let maxFontSize = parseInt(option[`${maxFont}Style`].font)\n        if (maxFontSize && option.width < maxFontSize) option.width = maxFontSize\n\n        this._text(parseContext, option)\n        this._resetCtx()._next()\n    })\n    return this\n}\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/)\n    let result = []\n    for(let i= 0;i<arr.length;i++){\n        let value = arr[i]\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large'\n            let tmp = arr[i].split(splitTag)\n            result.push({\n                type,\n                text:tmp[0],\n                // 用于字体的大小比较；\n                size: type == 'small' ? 0 : 2,\n            })\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n                size: 1,\n            })\n            continue\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n            size: 1,\n        })\n    }\n    return result\n}\n\nMCanvas.prototype._text = function(textArr,option){\n\n    this.data.textId++\n    this.data.text[this.data.textId] = {}\n\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width,0,option.width,'pos')\n\n    let style, line = 1, length = 0,\n        lineHeight = getLineHeight(textArr,option),\n        x = this._get(this.canvas.width,option.width,0 ,'pos'),\n        y = (this._get(this.canvas.height,0 ,0 ,'pos')) + lineHeight\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.data.text[this.data.textId][line] = {\n        data:[],\n        lineWidth:0,\n    }\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`]\n        this.ctx.font = style.font\n        let width = this.ctx.measureText(v.text).width\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g,'|')\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i = 0,fontLength = context.length; i < fontLength; i++) {\n                let font = context[i]\n                width = this.ctx.measureText(font).width\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font == '|'){\n                    length = 0\n                    x = this._get(this.canvas.width,option.width, 0, 'pos')\n                    y += lineHeight\n                    line += 1\n                    this.data.text[this.data.textId][line] = {\n                        data:[],\n                        lineWidth:0,\n                    }\n                    if(font == '|')continue\n                }\n                this.data.text[this.data.textId][line]['data'].push({\n                    context:font,x,y,style,width,\n                })\n                length += width\n                x += width\n                this.data.text[this.data.textId][line]['lineWidth'] = length\n            }\n        }else{\n            this.data.text[this.data.textId][line]['data'].push({\n                context,x,y,style,width,\n            })\n            length += width\n            x += width\n            this.data.text[this.data.textId][line]['lineWidth'] = length\n        }\n    })\n\n    // 创建文字画布；\n    const tcvs = document.createElement('canvas')\n    const tctx = tcvs.getContext('2d')\n    const tdx = this._get(this.canvas.width,option.width,option.pos.x ,'pos'), \n          tdy = this._get(this.canvas.height,0 ,option.pos.y ,'pos')\n    let tdw, tdh\n    tdw = tcvs.width = option.width\n    tdh = tcvs.height = this._getTextRectHeight(line)\n        \n    // 通过字体数据进行文字的绘制；\n    _.forin(this.data.text[this.data.textId],(k,v)=>{\n        // \b增加 align 的功能；\n        let add = 0\n        if(v.lineWidth < option.width){\n            if(option.align == 'center'){\n                add = (option.width - v.lineWidth)/2\n            }else if (option.align == 'right') {\n                add = option.width - v.lineWidth\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add\n            this._fillText(tctx, text)\n        })\n    })\n\n    // tcvs.style.width = '300px';\n    // document.querySelector('body').appendChild(tcvs);\n    \n    // 绘制文字画布；\n    const originX = tdx + tdw/2,\n          originY = tdy + tdh/2\n    this.ctx.translate(originX, originY)\n    this.ctx.rotate(parseFloat(option.pos.rotate) * Math.PI / 180)\n    this.ctx.drawImage(tcvs,-tdw/2, -tdh/2, tdw, tdh)\n\n    // 获取行高；\n    function getLineHeight(textArr,option) {\n        let lh = 0,vlh\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineHeight\n            if(vlh > lh)lh = vlh\n        })\n        return lh\n    }\n}\n\nMCanvas.prototype._fillText = function(ctx, text){\n    let {context, x, y, style} = text\n    let {align, lineWidth, shadow} = style\n    let {color, blur, offsetX, offsetY} = shadow\n    ctx.font = style.font\n    ctx.textAlign = align\n    ctx.textBaseline = 'alphabetic'\n    ctx.lineWidth = lineWidth\n    ctx.shadowColor = color\n    ctx.shadowBlur = blur\n    ctx.shadowOffsetX = offsetX\n    ctx.shadowOffsetY = offsetY\n\n    if(style.gradient){\n        let { type, colorStop } = style.gradient\n        let x1, y1, x2, y2\n        if(type == 1){\n            x1 = x; y1 = y\n            x2 = x + text.width; y2 = y \n        }else{\n            x1 = x; y1 = y - style.lineHeight\n            x2 = x; y2 = y\n        }\n        let grad  = ctx.createLinearGradient(x1,y1,x2,y2)\n        let colorNum = colorStop.length || 0\n        _.forin(colorStop, (i, v)=>{\n            grad.addColorStop(1/colorNum*(+i+1),v)\n        })\n        ctx[`${style.type}Style`] = grad\n    }else{\n        ctx[`${style.type}Style`] = style.color\n    }\n\n    ctx[`${style.type}Text`](context,x,y)\n    this._resetCtx()\n}\n\nMCanvas.prototype._getTextRectHeight = function (lastLine) {\n    const lastLineData = this.data.text[this.data.textId][lastLine].data[0]\n    return lastLineData.y + lastLineData.style.lineHeight\n}\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par,child,str,type){\n    let result = str\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type == 'pos'){\n            let arr = str.split(':')\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''))\n                    break\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px',''))) - child\n                    break\n                default:\n            }\n        }else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            if(type == 'crop'){\n                result = child * (+str.replace('%', '')) / 100\n            }else{\n                result = par * (+str.replace('%', '')) / 100\n            }\n        } else if (str == 'center'){\n            result = (par-child)/2\n        } else if (str == 'origin') {\n            result = child\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\n// 绘制函数；\nMCanvas.prototype.draw = function(ops){\n    let _ops = {\n        type:'jpg',\n        quality:.9,\n        success(){},\n        error(){},\n    }, b64\n    if(typeof ops == 'function'){\n        _ops.success = ops\n    }else{\n        _ops = _.extend(_ops,ops)\n        if(_ops.type == 'jpg')_ops.type = 'jpeg'\n    }\n    this.fn.error = _ops.error\n    this.fn.success = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL(`image/${_ops.type}`, _ops.quality)\n            _ops.success(b64)\n        },0)\n    }\n    this._next()\n    return this\n}\n\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()()\n    }else{\n        this.fn.success()\n    }\n}\n\nMCanvas.prototype.clear = function(){\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    return this\n}\n"],"names":["extend","obj1","obj2","type","isType","forin","k","v","vType","i","length","loadImage","image","loaded","error","img","Image","indexOf","crossOrigin","onload","setTimeout","onerror","src","isObject","tar","isObjFunc","isBoolean","isArr","getImage","cbk","console","log","obj","hasOwnProperty","isIos8","UA","window","navigator","userAgent","toLowerCase","IOS","test","IPAD","match","deepCopy","JSON","parse","stringify","name","Object","prototype","toString","call","split","replace","getSize","iw","ih","tagName","naturalWidth","naturalHeight","width","height","offsetWidth","offsetHeight","options","_","icon","color","cvs","document","createElement","ctx","getContext","save","drawImage","globalCompositeOperation","fillStyle","fillRect","style","querySelector","appendChild","err","iconHover","_iconHover","MCanvas","ops","backgroundColor","canvas","queue","fn","success","data","textId","text","bgConfig","_init","setBgColor","background","bg","push","_background","_getBgAlign","left","cw","cropScale","rv","Math","abs","_getSize","iRatio","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","top","_next","rect","fillColor","strokeColor","strokeWidth","ch","_get","x","y","lineWidth","strokeStyle","beginPath","strokeRect","closePath","_resetCtx","circle","r","arc","PI","fill","stroke","setTransform","restore","watermark","pos","margin","position","scale","rotate","add","def","crop","forEach","_add","_handleOps","warn","cdx","cdy","cdw","cdh","lsx","lsy","lsw","lsh","cratio","ldx","ldy","ldw","ldh","lcvs","lctx","_ratio","lctxScale","spaceX","spaceY","shrink","round","map","translate","ratio","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","context","fontFamily","size","defaultStyle","shadow","blur","offsetX","offsetY","option","align","smallStyle","font","lineHeight","normalStyle","largeStyle","parseContext","_parse","max","maxFont","maxFontSize","parseInt","_text","arr","result","value","splitTag","tmp","textArr","line","getLineHeight","measureText","fontLength","tcvs","tctx","tdx","tdy","tdw","tdh","_getTextRectHeight","_fillText","originX","originY","lh","vlh","textAlign","textBaseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","gradient","colorStop","x1","y1","x2","y2","grad","createLinearGradient","colorNum","addColorStop","lastLine","lastLineData","par","child","str","draw","_ops","quality","b64","toDataURL","shift","clear","clearRect"],"mappings":"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"}