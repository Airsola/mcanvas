{"version":3,"file":"mcanvas.es.js","sources":["../lib/utils.js","../lib/mcanvas.js","../lib/mcrop.js","../lib/index.js"],"sourcesContent":["export default {\n    extend(obj1, obj2) {\n        let type = this.isType(obj2)\n        if(type === 'object'){\n            this.forin(obj2, (k, v) => {\n                let vType = this.isType(v)\n                if (vType !== 'object' && vType !== 'array') {\n                    obj1[k] = v\n                } else {\n                    if (this.isType(obj1[k]) !== vType || obj1[k] === null) {\n                        obj1[k] = vType === 'object' ? {} : []\n                    }\n                    this.extend(obj1[k], v)\n                }\n            })\n        }else if(type === 'array'){\n            for (let i = 0; i < obj2.length; i++) {\n                obj1[i] = obj2[i]\n            }\n        }else{\n            obj1 = obj2\n        }\n        return obj1\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image()\n        if(image.indexOf('http') === 0){\n            img.crossOrigin = '*'\n        }\n        img.onload = () => {\n            loaded(img)\n            setTimeout(() => img = null, 1000)\n        }\n        img.onerror = () => {\n            error('img load error')\n        }\n        img.src = image\n    },\n    isObject(tar){\n        return this.isObjFunc(tar, 'Object')\n    },\n    isBoolean(tar){\n        return this.isObjFunc(tar, 'Boolean')\n    },\n    isArr(tar){\n        return this.isObjFunc(tar, 'Array')\n    },\n    getImage(image, cbk, error){\n        if(typeof image === 'string'){\n            this.loadImage(image, img => {\n                cbk(img)\n            }, error)\n        }else if(typeof image === 'object'){\n            cbk(image)\n        }else{\n            console.log('add image error')\n            return\n        }\n    },\n    forin(obj, cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k, obj[k])\n            }\n        }\n    },\n    isIos8(){\n        let UA = window.navigator.userAgent.toLowerCase()\n        let IOS = /(iPhone|iPad|iPod|iOS)/gi.test(UA)\n        let IPAD = /(iPad)/gi.test(UA)\n        if(IOS){\n            return IPAD ? UA.match(/cpu os (\\d*)/)[1] < 9 : UA.match(/iphone os (\\d*)/)[1] < 9\n        }else{\n            return false\n        }\n    },\n    deepCopy(obj){\n        return JSON.parse(JSON.stringify(obj))\n    },\n    isObjFunc(tar, name) {\n        return Object.prototype.toString.call(tar) === '[object ' + name + ']'\n    },\n    isType(tar){\n        return Object.prototype.toString.call(tar).split(' ')[1].replace(']', '').toLowerCase()\n    },\n    getSize(img){\n        let iw, ih\n        if(img.tagName === 'IMG'){\n            iw = img.naturalWidth\n            ih = img.naturalHeight\n        }else if(img.tagName === 'CANVAS'){\n            iw = img.width\n            ih = img.height\n        }else{\n            iw = img.offsetWidth\n            ih = img.offsetHeight\n        }\n        return { iw, ih }\n    },\n}\n","import _ from './utils'\n\nexport default function MCanvas(options = {}){\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))return new MCanvas(options)\n\n    // 配置canvas初始大小；\n    // width：画布宽度，Number,选填，默认为 500;\n    // height: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = _.extend({\n        width: 500,\n        height: 500,\n        backgroundColor : '',\n    }, options)\n\n    // 全局画布；\n    this.canvas = null\n    this.ctx = null\n    // 绘制函数队列；\n    this.queue = []\n    // 回调函数池；\n    this.fn = {\n        // 最后执行的函数；\n        success(){},\n        // 错误回调；\n        error(){},\n    }\n    this.data = {\n        // 文字id；\n        textId: 0,\n        // 文字绘制数据；\n        text : {},\n        // 背景图数据;\n        bgConfig : null,\n    }\n\n    // 初始化创建画布；\n    this._init()\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas')\n    this.canvas.width = this.ops.width\n    this.canvas.height = this.ops.height\n    this.ctx = this.canvas.getContext('2d')\n    this.ctx.save()\n\n    this.ops.backgroundColor && this.setBgColor(this.ops.backgroundColor)\n}\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(image, bg = {\n    type : 'origin',\n}){\n    if(!image && !this.data.bgConfig){\n        console.error('mcanvas error : the init background must has a image.')\n        return\n    }\n\n    // 缓存bg options， 用于重置；\n    if(!image){\n        bg = this.data.bgConfig\n    }else{\n        bg.image = image\n        this.data.bgConfig = bg\n    }\n\n    this.queue.push(() => {\n        if(bg.color)this.setBgColor(bg.color)\n        _.getImage(bg.image, img =>{\n            this._background(img, bg)\n        }, this.fn.error)\n    })\n    return this\n}\n\n// 设置画布颜色;\nMCanvas.prototype.setBgColor = function(color){\n    this.ctx.fillStyle = color\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n}\n\nMCanvas.prototype._getBgAlign = function(left, iw, cw, cropScale){\n    let rv\n    if(typeof left === 'string'){\n        if(left === '50%' || left === 'center'){\n            rv = Math.abs((iw - cw / cropScale) / 2)\n        }else if(left === '100%'){\n            rv = Math.abs(iw - cw / cropScale)\n        }else if(left === '0%'){\n            rv = 0\n        }\n    }else if(typeof left === 'number'){\n        rv = left\n    }else{\n        rv = 0\n    }\n    return rv\n}\nMCanvas.prototype._background = function(img, bg){\n    let { iw, ih } = _.getSize(img)\n    // 图片与canvas的长宽比；\n    let iRatio = iw / ih\n    let cRatio = this.canvas.width / this.canvas.height\n    // 背景绘制参数；\n    let sx, sy, swidth, sheight, dx, dy, dwidth, dheight\n    let cropScale\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            if(iRatio > cRatio){\n                swidth = ih * cRatio\n                sheight = ih\n                cropScale = this.canvas.height / ih\n            }else{\n                swidth = iw\n                sheight = swidth / cRatio\n                cropScale = this.canvas.width / iw\n            }\n\n            sx = this._getBgAlign(bg.left, iw, this.canvas.width, cropScale)\n            sy = this._getBgAlign(bg.top, ih, this.canvas.height, cropScale)\n\n            dy = dx = 0\n            dheight = this.canvas.height\n            dwidth = this.canvas.width\n            break\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0\n            swidth = iw\n            sheight = ih\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width\n                dheight = dwidth / iRatio\n                dx = bg.left || 0\n                dy = (bg.top || bg.top === 0) ? bg.top : (this.canvas.height - dheight) / 2\n            }else{\n                dheight = this.canvas.height\n                dwidth = dheight * iRatio\n                dy = bg.top || 0\n                dx = (bg.left || bg.left === 0) ? bg.left : (this.canvas.width - dwidth) / 2\n            }\n            break\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = iw\n            this.canvas.height = ih\n            sx = sy = 0\n            swidth = iw\n            sheight = ih\n            dx = dy = 0\n            dwidth = this.canvas.width\n            dheight = this.canvas.height\n            break\n        default:\n            console.error('mcanvas error:background type error!')\n            return\n    }\n    this.ctx.drawImage(img, sx, sy, swidth, sheight, dx, dy, dwidth, dheight)\n    this._next()\n}\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制矩形层；\nMCanvas.prototype.rect = function(ops){\n    this.queue.push(() => {\n        let { fillColor = '#fff', strokeColor = fillColor, strokeWidth = 0 } = ops\n        let cw = this.canvas.width, ch = this.canvas.height\n        let width = this._get(cw, 0, ops.width || 0, 'pos') - 2 * strokeWidth,\n            height = this._get(ch, 0, ops.height || 0, 'pos') - 2 * strokeWidth\n        let x = this._get(cw, width, ops.x || 0, 'pos') + strokeWidth / 2,\n            y = this._get(ch, height, ops.y || 0, 'pos') + strokeWidth / 2\n        this.ctx.lineWidth = strokeWidth\n        this.ctx.fillStyle = fillColor\n        this.ctx.strokeStyle = strokeColor\n\n        this.ctx.beginPath()\n        this.ctx.strokeRect(x, y, width, height)\n        this.ctx.fillRect(x, y, width, height)\n        this.ctx.closePath()\n\n        this._resetCtx()._next()\n    })\n    return this\n}\n\n// 绘制圆形层；\nMCanvas.prototype.circle = function(ops){\n    this.queue.push(() => {\n        let { fillColor = '#fff', strokeColor = fillColor, strokeWidth = 0 } = ops\n        let cw = this.canvas.width, ch = this.canvas.height\n        let r = this._get(cw, 0, ops.r || 0, 'pos') - 2 * strokeWidth\n        let x = this._get(cw, 2 * r, ops.x || 0, 'pos') + strokeWidth / 2 + r,\n            y = this._get(ch, 2 * r, ops.y || 0, 'pos') + strokeWidth / 2 + r\n\n        this.ctx.beginPath()\n        this.ctx.arc(x, y, r, 0, Math.PI * 2, false)\n        this.ctx.fillStyle = fillColor\n        this.ctx.fill()\n        this.ctx.strokeStyle = strokeColor\n        this.ctx.lineWidth = strokeWidth\n        this.ctx.stroke()\n        this.ctx.closePath()\n\n        this._resetCtx()._next()\n    })\n    return this\n}\n\n// 重置ctx属性;\nMCanvas.prototype._resetCtx = function(){\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0)\n    this.ctx.restore()\n    return this\n}\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '', ops){\n    if(!image){\n        console.error('mcanvas error : there is not image of watermark.')\n        return\n    }\n    // 参数默认值；\n    let { width = '40%', pos = 'rightbottom', margin = 20 } = ops\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    }\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`\n            position.y = `top:${margin}`\n            break\n        case 'leftBottom':\n            position.x = `left:${margin}`\n            position.y = `bottom:${margin}`\n            break\n        case 'rightTop':\n            position.x = `right:${margin}`\n            position.y = `top:${margin}`\n            break\n        case 'rightBottom':\n            position.x = `right:${margin}`\n            position.y = `bottom:${margin}`\n            break\n        default:\n    }\n    this.add(image, {\n        width,\n        pos:position,\n    })\n    return this\n}\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '', options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    }\n\n    if(!_.isArr(image))image = [{image, options}]\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img, this._handleOps(_.extend(def, v.options), img))\n            }, this.fn.error)\n        })\n    })\n\n    return this\n}\n\nMCanvas.prototype._add = function(img, ops){\n    if(ops.width === 0)console.warn(`mcanvas warn: the width of mc-element is zero`)\n    let { iw, ih } = _.getSize(img)\n    // let ratio = iw / ih;\n    // 画布canvas参数；\n    let cdx, cdy, cdw, cdh\n    // 素材canvas参数；\n    let { x: lsx, y: lsy, width: lsw, height: lsh } = ops.crop\n\n    let cratio = lsw / lsh\n    let ldx, ldy, ldw, ldh\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas')\n    let lctx = lcvs.getContext('2d')\n    // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n    // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n    // _ratio 为 较大边 / 较小边 的比例；\n    let _ratio = iw > ih ? iw / ih : ih / iw\n    let lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4\n    let spaceX, spaceY\n\n    lcvs.width =  Math.round(lsw * lctxScale)\n    lcvs.height = Math.round(lsh * lctxScale)\n\n    // 限制canvas的大小，ios8以下为 2096, 其余平台均限制为 4096;\n    let shrink\n    if(_.isIos8() && (lcvs.width > 2096 || lcvs.height > 2096)){\n        if(cratio > 1){\n            shrink = 2096 / lcvs.width\n        }else{\n            shrink = 2096 / lcvs.height\n        }\n    }else if(lcvs.width > 4096 || lcvs.height > 4096){\n        if(cratio > 1){\n            shrink = 4096 / lcvs.width\n        }else{\n            shrink = 4096 / lcvs.height\n        }\n    }\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = - Math.round(lsw / 2)\n    ldy = - Math.round(lsh / 2)\n    ldw = lsw\n    ldh = Math.round(lsw / cratio)\n\n    // 获取素材最终的宽高;\n    if(shrink){\n        [lcvs.width, lcvs.height, ldx, ldy, ldw, ldh] = [lcvs.width, lcvs.height, ldx, ldy, ldw, ldh].map(v => Math.round(v * shrink))\n    }\n\n    lctx.translate(lcvs.width / 2, lcvs.height / 2)\n    lctx.rotate(ops.pos.rotate)\n    \n    lctx.drawImage(img, lsx, lsy, lsw, lsh, ldx, ldy, ldw, ldh)\n\n    cdw = Math.round(ops.width * lctxScale)\n    cdh = Math.round(cdw / cratio)\n\n    spaceX = (lctxScale - 1) * ops.width / 2\n    spaceY = spaceX / cratio\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = Math.round(ops.pos.x + cdw * ( 1 - ops.pos.scale ) / 2 - spaceX)\n    cdy = Math.round(ops.pos.y + cdh * ( 1 - ops.pos.scale ) / 2 - spaceY)\n\n    cdw *= ops.pos.scale\n    cdh *= ops.pos.scale\n\n    this.ctx.drawImage(lcvs, cdx, cdy, cdw, cdh)\n\n    lcvs = lctx = null\n    this._next()\n}\n\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops, img){\n    let cw = this.canvas.width,\n        ch = this.canvas.height\n    let { iw, ih } = _.getSize(img)\n\n    // 图片宽高比；\n    let ratio = iw / ih\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw, iw, ops.width, 'pos')\n\n    // 裁剪的最大宽高；\n    let maxLsw, maxLsh\n\n    // 裁剪参数；\n    let { x:cropx, y:cropy, width:cropw, height:croph } = ops.crop\n    let crop = {}\n    crop.width = this._get(cw, iw, cropw, 'crop')\n    crop.height = this._get(ch, ih, croph, 'crop')\n    crop.x = this._get(iw, crop.width, cropx, 'crop')\n    crop.y = this._get(ih, crop.height, cropy, 'crop')\n\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw\n    if(crop.y > ih)crop.y = ih\n    maxLsw = iw - crop.x\n    maxLsh = ih - crop.y\n    if(crop.width > maxLsw)crop.width = maxLsw\n    if(crop.height > maxLsh)crop.height = maxLsh\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos\n    let pos = {\n        x:this._get(cw, width, px, 'pos'),\n        y:this._get(ch, width / ratio, py, 'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    }\n    return {width, crop, pos}\n}\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`\n    // 默认的字体大小;\n    let size = this.canvas.width / 20\n\n    this.queue.push(()=>{\n        let defaultStyle = {\n            color:'#000',\n            type : 'fill',   // strokeText or fillText,\n            lineWidth : 1,\n            shadow:{\n                color: null,\n                blur: 0,\n                offsetX: 0,\n                offsetY: 0,\n            },\n        }\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                lineHeight:size * 0.9,\n                ..._.deepCopy(defaultStyle),\n            },\n            normalStyle:{\n                font : `${size}px ${fontFamily}`,\n                lineHeight:size * 1.1,\n                type : 'fill',   // strokeText or fillText,\n                ..._.deepCopy(defaultStyle),\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                lineHeight:size * 1.4,\n                ..._.deepCopy(defaultStyle),\n            },\n            pos:{\n                x:0,\n                y:0,\n                rotate: 0,\n            },\n        }\n\n        option = _.extend(option, ops)\n\n        // 解析字符串模板后，调用字体绘制函数；\n        let parseContext = this._parse(context)\n        let max = 0, maxFont\n        parseContext.map(v => {\n            if (v.size > max) {\n                max = v.size\n                maxFont = v.type\n            }\n        })\n        // 当设置的宽度小于字体宽度时，强行将设置宽度设为与字体一致；\n        let maxFontSize = parseInt(option[`${maxFont}Style`].font)\n        if (maxFontSize && option.width < maxFontSize) option.width = maxFontSize\n\n        this._text(parseContext, option)\n        this._resetCtx()._next()\n    })\n    return this\n}\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/)\n    let result = []\n    for(let i = 0;i < arr.length;i++){\n        let value = arr[i]\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large'\n            let tmp = arr[i].split(splitTag)\n            result.push({\n                type,\n                text:tmp[0],\n                // 用于字体的大小比较；\n                size: type === 'small' ? 0 : 2,\n            })\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n                size: 1,\n            })\n            continue\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n            size: 1,\n        })\n    }\n    return result\n}\n\nMCanvas.prototype._text = function(textArr, option){\n\n    this.data.textId++\n    this.data.text[this.data.textId] = {}\n\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width, 0, option.width, 'pos')\n\n    let style, line = 1, length = 0,\n        lineHeight = getLineHeight(textArr, option),\n        x = this._get(this.canvas.width, option.width, 0, 'pos'),\n        y = (this._get(this.canvas.height, 0, 0, 'pos')) + lineHeight\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.data.text[this.data.textId][line] = {\n        data:[],\n        lineWidth:0,\n    }\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`]\n        this.ctx.font = style.font\n        let width = this.ctx.measureText(v.text).width\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g, '|')\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i = 0, fontLength = context.length; i < fontLength; i++) {\n                let font = context[i]\n                width = this.ctx.measureText(font).width\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font === '|'){\n                    length = 0\n                    x = this._get(this.canvas.width, option.width, 0, 'pos')\n                    y += lineHeight\n                    line += 1\n                    this.data.text[this.data.textId][line] = {\n                        data:[],\n                        lineWidth:0,\n                    }\n                    if(font === '|')continue\n                }\n                this.data.text[this.data.textId][line]['data'].push({\n                    context:font, x, y, style, width,\n                })\n                length += width\n                x += width\n                this.data.text[this.data.textId][line]['lineWidth'] = length\n            }\n        }else{\n            this.data.text[this.data.textId][line]['data'].push({\n                context, x, y, style, width,\n            })\n            length += width\n            x += width\n            this.data.text[this.data.textId][line]['lineWidth'] = length\n        }\n    })\n\n    // 创建文字画布；\n    const tcvs = document.createElement('canvas')\n    const tctx = tcvs.getContext('2d')\n    const tdx = this._get(this.canvas.width, option.width, option.pos.x, 'pos'), \n          tdy = this._get(this.canvas.height, 0, option.pos.y, 'pos')\n    let tdw, tdh\n    tdw = tcvs.width = option.width\n    tdh = tcvs.height = this._getTextRectHeight(line)\n        \n    // 通过字体数据进行文字的绘制；\n    _.forin(this.data.text[this.data.textId], (k, v)=>{\n        // \b增加 align 的功能；\n        let add = 0\n        if(v.lineWidth < option.width){\n            if(option.align === 'center'){\n                add = (option.width - v.lineWidth) / 2\n            }else if (option.align === 'right') {\n                add = option.width - v.lineWidth\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add\n            this._fillText(tctx, text)\n        })\n    })\n\n    // tcvs.style.width = '300px';\n    // document.querySelector('body').appendChild(tcvs);\n    \n    // 绘制文字画布；\n    const originX = tdx + tdw / 2,\n          originY = tdy + tdh / 2\n    this.ctx.translate(originX, originY)\n    this.ctx.rotate(parseFloat(option.pos.rotate) * Math.PI / 180)\n    this.ctx.drawImage(tcvs, -tdw / 2, -tdh / 2, tdw, tdh)\n\n    // 获取行高；\n    function getLineHeight(textArr, option) {\n        let lh = 0, vlh\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineHeight\n            if(vlh > lh)lh = vlh\n        })\n        return lh\n    }\n}\n\nMCanvas.prototype._fillText = function(ctx, text){\n    let {context, x, y, style} = text\n    let {align, lineWidth, shadow} = style\n    let {color, blur, offsetX, offsetY} = shadow\n    ctx.font = style.font\n    ctx.textAlign = align\n    ctx.textBaseline = 'alphabetic'\n    ctx.lineWidth = lineWidth\n    ctx.shadowColor = color\n    ctx.shadowBlur = blur\n    ctx.shadowOffsetX = offsetX\n    ctx.shadowOffsetY = offsetY\n\n    if(style.gradient){\n        let { type, colorStop } = style.gradient\n        let x1, y1, x2, y2\n        if(type === 1){\n            x1 = x; y1 = y\n            x2 = x + text.width; y2 = y \n        }else{\n            x1 = x; y1 = y - style.lineHeight\n            x2 = x; y2 = y\n        }\n        let grad  = ctx.createLinearGradient(x1, y1, x2, y2)\n        let colorNum = colorStop.length || 0\n        _.forin(colorStop, (i, v)=>{\n            grad.addColorStop(1 / colorNum * (+i + 1), v)\n        })\n        ctx[`${style.type}Style`] = grad\n    }else{\n        ctx[`${style.type}Style`] = style.color\n    }\n\n    ctx[`${style.type}Text`](context, x, y)\n    this._resetCtx()\n}\n\nMCanvas.prototype._getTextRectHeight = function (lastLine) {\n    const lastLineData = this.data.text[this.data.textId][lastLine].data[0]\n    return lastLineData.y + lastLineData.style.lineHeight\n}\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par, child, str, type){\n    let result = str\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type === 'pos'){\n            let arr = str.split(':')\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px', ''))\n                    break\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px', ''))) - child\n                    break\n                default:\n            }\n        } else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            if(type === 'crop'){\n                result = child * (+str.replace('%', '')) / 100\n            }else{\n                result = par * (+str.replace('%', '')) / 100\n            }\n        } else if (str === 'center'){\n            result = (par - child) / 2\n        } else if (str === 'origin') {\n            result = child\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\n// 绘制函数；\nMCanvas.prototype.draw = function(ops){\n    let _ops = {\n        type:'jpeg',\n        quality:.9,\n        success(){},\n        error(){},\n    }, b64\n    if(typeof ops === 'function'){\n        _ops.success = ops\n    }else{\n        _ops = _.extend(_ops, ops)\n        if(_ops.type === 'jpg')_ops.type = 'jpeg'\n    }\n    this.fn.error = _ops.error\n    this.fn.success = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL(`image/${_ops.type}`, _ops.quality)\n            _ops.success(b64)\n        }, 0)\n    }\n    this._next()\n    return this\n}\n\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()()\n    }else{\n        this.fn.success()\n    }\n}\n\nMCanvas.prototype.clear = function(){\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    return this\n}","import _ from './utils'\n\n// 加工获取 pos.x 和 pos.y\nconst getPos = (imgW, cropW, str) => {\n    if (!str && str !== 0) return str\n    let result = str\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1){\n            let arr = str.split(':')\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px', ''))\n                    break\n                case 'right':\n                case 'bottom':\n                    result = imgW - (+(arr[1].replace('px', '')))\n                    break\n                default:\n            }\n        } else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            result = imgW * (+str.replace('%', '')) / 100\n        } else if (str === 'center'){\n            result = (imgW - cropW) / 2\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\n// 获取长度\nconst getLength = (imgW, str) => {\n    if (!str && str !== 0) return str\n    let result = str\n    if(typeof str === 'string'){\n        if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''))\n        } else if (str.indexOf('%') !== -1) {\n            result = imgW * (+str.replace('%', '')) / 100\n        } else if (str === 'center'){\n            result = imgW / 2\n        } else {\n            result = +str\n        }\n    }\n    return Math.round(result)\n}\n\n// interface ops {\n//     type: 'rect' | 'circle' | 'triangle'\n//  左上角坐标\n//     x: number | string \n//     y: number | string\n//  type = 'rect' 时有效\n//     width?: number | string\n//     height?: number | string\n//  type = 'circle' 时有效   \n//     r?: number | string\n//     exportConfig?: {\n//         type: 'jpg' | 'png' | 'jpeg'\n//         quality: number (0 - 1)\n//     }\n// }\n\nexport default function MCrop(image, ops = {}){\n    if (!image) {\n        console.error('mcrop error : there is not a image.')\n        return\n    }\n    const { success = () => {}, error = () => {} } = ops\n    _.getImage(image, img => {\n        const { iw, ih } = _.getSize(img)\n        const minL = Math.min(iw, ih)\n        const { type = 'rect' } = ops\n        const cvs = document.createElement('canvas')\n        const ctx = cvs.getContext('2d')\n        \n        if (type === 'rect') {\n            let width = getLength(iw, ops.width) || iw\n            let height = getLength(ih, ops.height) || ih\n            if (width > iw) width = iw\n            if (height > ih) height = ih\n            const x = getPos(iw, width, ops.x)\n            const y = getPos(ih, height, ops.y)\n            // 扣除超出部分，避免截图出现空白\n            if (x + width > iw) width =  iw - x\n            if (y + height > ih) height =  ih - y\n            cvs.width = width\n            cvs.height = height     \n            ctx.drawImage(img, -x, -y, iw, ih)\n        } else if (type === 'circle') {\n            let r = getLength(minL, ops.r) || (minL / 2)\n            if (r * 2 > minL) r = minL / 2\n            const x = getPos(iw, r * 2, ops.x)\n            const y = getPos(ih, r * 2, ops.y)\n            cvs.width = r * 2\n            cvs.height = r * 2\n            ctx.beginPath()\n            ctx.arc(r, r, r, 0, Math.PI * 2, false)\n            ctx.fillStyle = '#fff'\n            ctx.fill()\n            ctx.globalCompositeOperation = 'source-in'\n            ctx.drawImage(img, -x, -y, iw, ih)\n        }\n        setTimeout(()=>{\n            const exportConfig = _.extend({\n                type: 'jpeg',\n                quality: .9,\n            }, ops.exportConfig || {}) \n\n            if (type === 'circle') {\n                exportConfig.type = 'png'\n            }\n            const b64 = cvs.toDataURL(`image/${exportConfig.type}`, exportConfig.quality)\n            success(b64)\n        }, 0)\n    }, err => {\n        console.error('mcrop error: load image error.', err)\n        error(err)\n    })\n}","import MCanvas from './mcanvas'\nimport _mcrop from './mcrop'\n\nexport const MCrop = _mcrop\nexport default MCanvas"],"names":["extend","obj1","obj2","type","isType","forin","k","v","vType","i","length","loadImage","image","loaded","error","img","Image","indexOf","crossOrigin","onload","setTimeout","onerror","src","isObject","tar","isObjFunc","isBoolean","isArr","getImage","cbk","console","log","obj","hasOwnProperty","isIos8","UA","window","navigator","userAgent","toLowerCase","IOS","test","IPAD","match","deepCopy","JSON","parse","stringify","name","Object","prototype","toString","call","split","replace","getSize","iw","ih","tagName","naturalWidth","naturalHeight","width","height","offsetWidth","offsetHeight","MCanvas","options","ops","_","backgroundColor","canvas","ctx","queue","fn","success","data","textId","text","bgConfig","_init","document","createElement","getContext","save","setBgColor","background","bg","push","color","_background","fillStyle","fillRect","_getBgAlign","left","cw","cropScale","rv","Math","abs","iRatio","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","top","drawImage","_next","rect","fillColor","strokeColor","strokeWidth","ch","_get","x","y","lineWidth","strokeStyle","beginPath","strokeRect","closePath","_resetCtx","circle","r","arc","PI","fill","stroke","setTransform","restore","watermark","pos","margin","position","scale","rotate","add","def","crop","forEach","_add","_handleOps","warn","cdx","cdy","cdw","cdh","lsx","lsy","lsw","lsh","cratio","ldx","ldy","ldw","ldh","lcvs","lctx","_ratio","lctxScale","spaceX","spaceY","round","shrink","map","translate","ratio","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","context","fontFamily","size","defaultStyle","shadow","blur","offsetX","offsetY","option","align","smallStyle","font","lineHeight","normalStyle","largeStyle","parseContext","_parse","max","maxFont","maxFontSize","parseInt","_text","arr","result","value","splitTag","tmp","textArr","style","line","getLineHeight","measureText","fontLength","tcvs","tctx","tdx","tdy","tdw","tdh","_getTextRectHeight","_fillText","originX","originY","lh","vlh","textAlign","textBaseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","gradient","colorStop","x1","y1","x2","y2","grad","createLinearGradient","colorNum","addColorStop","lastLine","lastLineData","par","child","str","draw","_ops","quality","b64","toDataURL","shift","clear","clearRect","getPos","imgW","cropW","getLength","MCrop","minL","min","cvs","globalCompositeOperation","exportConfig","err","_mcrop"],"mappings":"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"}